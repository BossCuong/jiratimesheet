<?xml version="1.0" encoding="utf-8"?>
<odoo>
 <!-- Views definition -->

    <record id="timesheet_line_tree" model="ir.ui.view">
        <field name="name">Timesheet Line Tree View</field>
        <field name="model">account.analytic.line</field>
        <field name="arch" type="xml">
            <tree editable="top" string="Timesheet Activities" import="false">
                <field name="date"/>
                <field name="name"/>
                <field name="project_id" required="1"/>
                <field name="task_id" context="{'default_project_id': project_id}" domain="[('project_id', '=', project_id)]"/>
                <field name="unit_amount" widget="timesheet_uom" sum="Total"/>
            </tree>
        </field>
    </record>

    <record id="timesheet_line_grid" model="ir.ui.view">
            <field name="name">jira timesheet</field>
            <field name="model">account.analytic.line</field>
            <field name="arch" type="xml">
                <grid string="Timesheets" adjustment="object" adjust_name="adjust_grid">
                    <button name="button_sync" type="object"
                        string="sync Jira's Timesheet" class="btn-primary"/>

                    <field name="project_id" type="row" section="1"/>
                    <field name="task_id" type="row"/>
                    <field name="date" type="col">
                        <range name="week" string="Week" span="week" step="day"/>
                        <range name="month" string="Month" span="month" step="day"/>
                    </field>
                    <field name="unit_amount" type="measure" widget="timesheet_uom" />
                </grid>
            </field>
    </record>

    <record id="view_search_byname" model="ir.ui.view">
        <field name="name">Worklog Filters</field>
        <field name="model">account.analytic.line</field>
        <field name="arch" type="xml">
          <search>
          <field name="task_id" />
          <field name="project_id" />
          <field name="employee_id"/>
          <filter name="filter_my_name"
                  string="My Worklog"
                  domain="[('employee_id.user_id','=', uid)]"/>
          <filter name="filter_worklog"
                  string="filter"
                  domain="[('unit_amount','>', 0)]"/>
          </search>
        </field>
    </record>

   <record id="jira_auto_generate_line" model="ir.cron">
        <field name="name">Base: auto generate new weekly worklog line</field>
        <field name="model_id" ref="model_account_analytic_line"/>
        <field name="state">code</field>
        <field name="code">model.auto_gen_new_line()</field>
        <field name='interval_number'>1</field>
        <field name='interval_type'>weeks</field>
        <field name="numbercall">-1</field>
    </record>

    <record model="ir.rule" id="jira_view_rule">
        <field name="name">Jira view rule</field>
        <field name="model_id" ref="model_account_analytic_line"/>
        <field name="global" eval="True"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
        <field name="domain_force">[('project_id.user_ids','in',[user.id])]</field>
    </record>
</odoo>
